import{a as ht,g as at,r as k,b as lt,_ as ot,d as O,j as s,s as nt,e as pt,T as $,f as X,h as ct,F as D,a7 as st,a8 as B,q as it,B as G,M as L,L as ut,H as dt,t as z}from"./index-DBS8pbof.js";import{n as q,t as U,G as P,T as Y,j as J,k as H,l as T,m as K}from"./util-CWYRFuDd.js";import{u as xt,a as mt,T as F,S as ft}from"./TextField-2xv4FU3H.js";import{C as wt}from"./Crement-BIEbfj_0.js";import{M as bt}from"./ModifierForm-BfFZFRvm.js";import{F as Q,C as V}from"./SaveForm-CSoxvA8o.js";import{T as jt}from"./TableHead-Bnsy9pD0.js";import"./Stack-BFE22zhZ.js";function vt(E){return at("MuiInputAdornment",E)}const Z=ht("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var tt;const Mt=["children","className","component","disablePointerEvents","disableTypography","position","variant"],Ct=(E,t)=>{const{ownerState:e}=E;return[t.root,t[`position${X(e.position)}`],e.disablePointerEvents===!0&&t.disablePointerEvents,t[e.variant]]},_t=E=>{const{classes:t,disablePointerEvents:e,hiddenLabel:i,position:n,size:p,variant:w}=E,b={root:["root",e&&"disablePointerEvents",n&&`position${X(n)}`,w,i&&"hiddenLabel",p&&`size${X(p)}`]};return ct(b,vt,t)},yt=nt("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:Ct})(({theme:E,ownerState:t})=>O({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(E.vars||E).palette.action.active},t.variant==="filled"&&{[`&.${Z.positionStart}&:not(.${Z.hiddenLabel})`]:{marginTop:16}},t.position==="start"&&{marginRight:8},t.position==="end"&&{marginLeft:8},t.disablePointerEvents===!0&&{pointerEvents:"none"})),et=k.forwardRef(function(t,e){const i=lt({props:t,name:"MuiInputAdornment"}),{children:n,className:p,component:w="div",disablePointerEvents:b=!1,disableTypography:h=!1,position:r,variant:c}=i,u=ot(i,Mt),x=xt()||{};let C=c;c&&x.variant,x&&!C&&(C=x.variant);const M=O({},i,{hiddenLabel:x.hiddenLabel,size:x.size,disablePointerEvents:b,position:r,variant:C}),a=_t(M);return s.jsx(mt.Provider,{value:null,children:s.jsx(yt,O({as:w,ownerState:M,className:pt(a.root,p),ref:e},u,{children:typeof n=="string"&&!h?s.jsx($,{color:"text.secondary",children:n}):s.jsxs(k.Fragment,{children:[r==="start"?tt||(tt=s.jsx("span",{className:"notranslate",children:"​"})):null,n]})}))})});function N(E,t){return E=Math.ceil(E),t=Math.floor(t),Math.floor(Math.random()*(t-E))+E}class gt{constructor(t){this.wishstats=t.wishstats,this.state=t}speed(t){let e=this.wishstats.wishspeed;return e*=q(this.wishstats,this.state,D.WISHES,{eBetaPot:2,eDeltaPot:2,mBetaPot:2,mDeltaPot:2,rBetaPot:2,rDeltaPot:3},t),e}cap_modifiers(){const t=q(this.wishstats,this.state,D.ENERGY_CAP,{}),e=q(this.wishstats,this.state,D.MAGIC_CAP,{}),i=q(this.wishstats,this.state,D.RES3_CAP,{});return[t,e,i]}base(t){return t.map(e=>Math.max(1e3,Math.floor(e/1e5)))}split(t,e){return t.map(i=>Math.max(1e3,Math.floor(i/e)))}update_res(t,e){return t.map((i,n)=>t[n]-e.reduce((p,w)=>w[n]+p,0))}score(t,e,i,n,p,w=-.17){let b=t;for(let r=0;r<i.length;r++)b*=i[r]**w;let h=0;for(let r=n+1;r<=p;r++)h+=Math.max(e,b/p*r);return Math.ceil(h)}score_raw(t,e,i,n,p,w=!1,b=-.17){let h=t;for(let c=0;c<i.length;c++)h*=i[c]**b;let r=0;for(let c=n+1;c<=p;c++)w||h>e?r+=Math.max(e,h/p*c):r+=h/p*c;return Math.ceil(r)}score_true(t,e,i,n,p,w=-.17){if(!this.wishstats.trueTime)return 0;let b=t;for(let u=0;u<i.length;u++)b*=i[u]**w;let h=0,r=0,c=n;for(let u=n+1;u<=p;u++){let x=this.actualtime(Math.max(e,b/p*u)),C=x[0],M=x[1],a=x[2];if(h+=C,r+=M,c+=a,a<1)break}return[Math.ceil(h),Math.ceil(r),c]}spread_res(t,e,i,n,p,w,b,h,r,c,u,x=0){const C=Math.max(...r.map((M,a)=>u[a]-c[a]))*p;return n.forEach(M=>{for(let a=b-1;a>=x;a--){let f=0;for(;f<1e3&&(f++,!(e[M]<b||i[b-1]===p*(u[a]-c[a])));){const d=a===0||i[a-1]===0?C:i[a-1]>C?i[a-1]:C;if(i[a]===d)break;let g=(i[b-1]/d)**(1/w),l=0;for(let m=a;m<b;m++)l+=t[m][M];g=Math.min(g,e[M]/l+1);let _=t.map(m=>m[M]*g);_=t.map((m,S)=>Math.min(_[S]-m[M],e[M]));let y=0;for(let m=a;m<b;m++)y+=Math.floor(_[m]+1)/t[m][M],t[m][M]+=Math.floor(_[m]+1);if(y<1e-4)break;e=this.update_res(h,t),i=t.map((m,S)=>this.score(r[S],p,m,c[S],u[S]))}}}),e=this.update_res(h,t),i=t.map((M,a)=>this.score(r[a],p,M,c[a],u[a])),[t,e,i]}topoff(t,e,i,n,p,w,b,h){let c=(this.score(t,n,e,w-1,w)/n)**(1/b);return h.forEach(u=>{if(i[u]===0)return;let x=e[u],C=Math.min(c*x,x+i[u]);C<x||(c=c*(x/C),e[u]=C)}),e}save_res(t,e,i,n,p,w,b,h,r,c,u,x,C,M){const a=n[x],f=C>-1?C:n[N(0,x)];let d=N(M,b);for(;u[d]===0;)d=N(M,b);let j=d;for(;d===j||u[j]===0;)j=N(M,b);if(t[d][a]<=this.BASE[a]&&t[j][a]<=this.BASE[a])return[t,e,i];if(i=t.map((A,R)=>this.score(r[R],p,A,c[R],u[R])),t[d][f]>t[j][f]){let A=d;d=j,j=A}e[f]>0&&[d,j].forEach(A=>{if(e[f]>0&&t[A][a]>1){const R=[...t[A]];t[A][f]=Math.ceil(R[f]+e[f]),R[f]/t[A][f]>=1&&console.log("error in wish assignment"),t[A][a]*=R[f]/t[A][f],t[A][a]=Math.ceil(t[A][a]),e=this.update_res(h,t)}});const g=t[d][f],l=t[j][f],_=t[d][a],y=t[j][a],m=l/g,S=y/_;if(m*S===1)return[t,e,i];const o=(m*S*(m+1)**2)**.5,v=(m+1+o)/(1-m*S),W=(m+1-o)/(1-m*S);let I;if(v<0&&W<0)return console.log("Wish error: both negative."),[t,e,i];if(v<0?I=W:W<0?I=v:I=v<W?v:W,I*g>l+g&&I*g>l+g+e[f])return console.log("Wish warning: too many resources requested."),[t,e,i];t[d][f]=Math.max(this.BASE[f],Math.ceil(I*g)),t[j][f]=Math.max(this.BASE[f],Math.ceil(l+g-t[d][f])),t[d][a]=Math.max(this.BASE[a],Math.ceil(g*_/t[d][f])),t[j][a]=Math.max(this.BASE[a],Math.ceil(l*y/t[j][f]));let rt=t[d][a]+t[j][a];return _+y-rt<this.BASE[a]&&(t[d][f]=g,t[j][f]=l,t[d][a]=_,t[j][a]=y),e=this.update_res(h,t),i=t.map((A,R)=>this.score(r[R],p,A,c[R],u[R])),[t,e,i]}capPct(t){return this.wishstats[`${t}cap`]*this.wishstats[`${t}pct`]/100}optimize(){let t=Date.now();const e=st[this.wishstats.rp_idx],i=this.wishstats.wishes.map(o=>B[o.wishidx][1]*o.goal),n=this.wishstats.wishcap*60*50,p=Math.max(...this.wishstats.wishes.map(o=>o.goal-o.start))*n,w=(this.wishstats.epow*this.wishstats.mpow*this.wishstats.rpow)**.17,b=(this.capPct("e")*this.capPct("m")*this.capPct("r"))**.17,h=.17,r=i.map((o,v)=>[o/this.speed(h)/w,this.wishstats.wishes[v].start,this.wishstats.wishes[v].goal]).sort((o,v)=>o[0]-v[0]),c=[Number(this.capPct("e")),Number(this.capPct("m")),Number(this.capPct("r"))];let u=[...c];const x=r.map(o=>o[0]),C=r.map(o=>o[1]),M=r.map(o=>o[2]);let a=x.map(o=>this.base(u));this.BASE=this.base(u),u=this.update_res(c,a);const f=x.length;let d=x.map((o,v)=>this.score(x[v],n,a[v],C[v],M[v])),j=0;for(;j<d.length&&d[j]<=p;)j++;if(u=u.map(o=>Math.max(0,o)),w===1&&b===1)return[d,a,u,d];this.wishstats.equalResources?(a=x.map(o=>this.split(u,x.length)),u=[0,0,0]):([a,u,d]=this.spread_res(a,u,d,e,n,h,f,c,x,C,M,j),[a,u,d]=this.optimize_res(a,u,d,e,n,h,f,c,x,C,p,M,j,i)),d=a.map((o,v)=>this.score(x[v],n,o,C[v],M[v]));let g=a.map((o,v)=>this.score_true(x[v],n,o,C[v],M[v]));const l=x.map((o,v)=>v).sort((o,v)=>i[o]-i[v]);let _=Array(f),y=Array(f),m=Array(f);for(let o=0;o<f;o++)_[l[o]]=a[o],y[l[o]]=d[o],m[l[o]]=g[o];a=_,d=y,g=m;const S=this.cap_modifiers();return u=u.map((o,v)=>Math.max(0,o*S[v])),a=a.map(o=>o.map((v,W)=>Math.max(0,v*S[W]))),console.log(Date.now()-t+" ms"),[d,a,u,g]}actualtime(t){if(t>10**8)return[1/0,0,0];let e=Math.fround(0),i=0;const n=Math.fround(Math.fround(1)/Math.fround(t)),p=Math.fround(1);for(;e<p;){const w=Math.fround(e+n);if(w===e)return console.log("early exit at ",e*100,"%"),[1/0,i,e];e=w,i+=1}return[i,i,1]}optimize_res(t,e,i,n,p,w,b,h,r,c,u,x,C,M){if(x.filter(f=>f>0).length-C>1)for(let d=0;d<1e3;d++){let j=e[1]<=0?N(1,3):1;[t,e,i]=this.save_res(t,e,i,n,p,w,b,h,r,c,x,j,-1,C);let g=Math.floor(Math.max(...i));for(let l=C;l<r.length;l++)if(r[l]!==0)for(let _=2;_>-1;_--){let y=n[_],m=this.score(r[l],p,t[l],c[l],x[l]);const S=t[l][y];if(Math.ceil(m)<g){for(t[l][y]=Math.ceil(t[l][y]*(g/m)**(-1/w)),m=Math.ceil(this.score(r[l],p,t[l],c[l],x[l]));m>g;)t[l][y]=Math.max(Math.ceil((t[l][y]+S)/2+S/1e3),S),m=Math.ceil(this.score(r[l],p,t[l],c[l],x[l]));e=this.update_res(h,t)}}if(Math.floor(Math.max(...i))===u){for(let l=C;l<r.length;l++)if(r[l]!==0&&!(i[l]<u))for(let _=2;_>-1;_--){let y=n[_],m=this.score(r[l],p,t[l],c[l],x[l]);const S=t[l][y];let o=S;for(;m===u;){if(o/=1.1,o<=1){o=1;break}t[l][y]=Math.max(this.BASE[y],Math.floor(o)),m=this.score(r[l],p,t[l],c[l],x[l])}if(o=Math.floor(o),o===1&&m===u)break;for(;m>u;){if(o*=1.05,o>=S){o=S;break}t[l][y]=Math.max(this.BASE[y],Math.ceil(o)),m=this.score(r[l],p,t[l],c[l],x[l])}e=this.update_res(h,t)}}e=this.update_res(h,t),i=t.map((l,_)=>this.score(r[_],p,l,c[_],x[_])),Math.floor(Math.max(...i))>u+100&&([t,e,i]=this.spread_res(t,e,i,n,p,w,b,h,r,c,x,C))}const a=Number(this.wishstats.spare_policy);return a>0&&(a===1?r.map((d,j)=>j):a===2?r.map((d,j)=>j).sort((d,j)=>M[d]-M[j]):[]).forEach(d=>{t[d]=this.topoff(r[d],t[d],e,p,c[d],x[d],w,n),e=this.update_res(h,t)}),[t,e,i]}}class St extends it.Component{constructor(t){super(t),this.state={rp_idx:this.props.rp_idx,spare_policy:this.props.spare_policy},this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleChange(t,e){this.setState({[e]:t.target.value}),this.props.handleChange(t,[e],this.props.rp_idx)}handleSubmit(t){t.preventDefault()}render(){if(this.props.wishstats.equalResources)return s.jsx(s.Fragment,{});this.state.rp_idx!==this.props.wishstats.rp_idx&&(this.state.rp_idx=this.props.wishstats.rp_idx),this.state.spare_policy!==this.props.wishstats.spare_policy&&(this.state.spare_policy=this.props.wishstats.spare_policy);const t="EMR",e=["save","speed up cheapest","speed up in order"];return s.jsxs(G,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2,mb:2},children:[s.jsx(F,{select:!0,label:"Resource spending order",value:this.state.rp_idx,onChange:i=>this.handleChange(i,"rp_idx"),fullWidth:!0,size:"small",children:st.map((i,n)=>s.jsx(L,{value:n,children:t[i[0]]+">"+t[i[1]]+">"+t[i[2]]},n))}),s.jsx(F,{select:!0,label:"Spare resource policy",value:this.state.spare_policy,onChange:i=>this.handleChange(i,"spare_policy"),fullWidth:!0,size:"small",children:e.map((i,n)=>s.jsx(L,{value:n,children:i},i))})]})}}class Pt extends it.Component{constructor(t){super(t),this.state={value:this.props.wishidx},this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleChange(t){this.setState({value:t.target.value}),this.props.handleChange(t,"wishidx",this.props.idx)}handleSubmit(t){t.preventDefault()}render(){return this.state.value!==this.props.wishidx&&(this.state.value=this.props.wishidx),s.jsx(F,{select:!0,label:"Wish "+(this.props.idx+1),value:this.state.value,onChange:this.handleChange,sx:{width:"200px",mr:2,mb:1},size:"small",children:B.map((t,e)=>s.jsx(L,{value:e,children:e+": "+B[e][0]},e))})}}class Nt extends k.Component{constructor(t){super(t),this.state={timeUnit:"minutes",isReady:!1},this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}componentDidMount(){setTimeout(()=>this.setState({isReady:!0}),300)}handleFocus(t){t.target.select()}handleSubmit(t){t.preventDefault()}handleChange(t,e,i=-1){let n=t.target.value;t.target.type==="checkbox"&&(n=t.target.checked);let p={...this.props.wishstats};if(i<0){p={...p,[e]:n},this.props.handleSettings("wishstats",p);return}let w=[...p.wishes];const b=e==="start"&&Number(n)>w[i].start;let h={...w[i],[e]:n};h.goal=this.goallevel(h,b),h.start=this.startlevel(h),w[i]=h,p={...p,wishes:w},this.props.handleSettings("wishstats",p)}goallevel(t,e){return t.goal=Number(t.goal),e&&(t.start=Number(t.start),t.start>=t.goal&&(t.goal=t.start+1)),t.goal<1?0:t.goal>B[t.wishidx][2]?B[t.wishidx][2]:t.goal}startlevel(t){return t.start=Number(t.start),t.start<0||t.goal===0?0:t.start>=t.goal?t.goal-1:t.start}wishtime(t){return t.wishtime<(t.goal-t.start)*t.wishcap?(t.goal-t.start)*t.wishcap:t.wishtime}copyToClipboard(t){t.target.select(),document.execCommand("copy")}render(){if(!this.state.isReady)return s.jsx(ut,{});dt.pageview("/wishes/");const e=new gt(this.props).optimize(),i=U(Math.max(...e[0])),n=e[0],p=e[1],w=e[2],b=e[3];return s.jsx(G,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:2},children:s.jsxs("form",{onSubmit:this.handleSubmit,children:[s.jsx(P,{container:!0,spacing:2,justifyContent:"center",sx:{mb:2},children:["eE","mM","rR"].map(h=>s.jsx(P,{item:!0,xs:12,md:4,children:s.jsx(z,{sx:{p:2},children:s.jsxs(P,{container:!0,spacing:1,children:[s.jsx(P,{item:!0,xs:12,children:s.jsx($,{variant:"subtitle1",align:"center",children:h[1]+" power"})}),s.jsx(P,{item:!0,xs:12,children:s.jsx(F,{label:"Power",type:"number",fullWidth:!0,value:this.props.wishstats[h[0]+"pow"],onChange:r=>this.handleChange(r,h[0]+"pow"),onFocus:this.handleFocus,inputProps:{step:"any"}})}),s.jsx(P,{item:!0,xs:12,children:s.jsx(F,{label:"Cap",type:"number",fullWidth:!0,value:this.props.wishstats[h[0]+"cap"],onChange:r=>this.handleChange(r,h[0]+"cap"),onFocus:this.handleFocus,inputProps:{step:"any"}})}),s.jsx(P,{item:!0,xs:12,children:s.jsx(F,{label:"Use (%)",type:"number",fullWidth:!0,value:this.props.wishstats[h[0]+"pct"],onChange:r=>this.handleChange(r,h[0]+"pct"),onFocus:this.handleFocus,inputProps:{step:"any"}})})]})})},h))}),s.jsx(z,{sx:{p:2,mb:2},children:s.jsxs(P,{container:!0,spacing:2,alignItems:"center",children:[s.jsx(P,{item:!0,xs:6,sm:4,children:s.jsx(F,{label:"Wish speed modifier",type:"number",fullWidth:!0,value:this.props.wishstats.wishspeed,onChange:h=>this.handleChange(h,"wishspeed"),onFocus:this.handleFocus,inputProps:{step:"any"}})}),s.jsx(P,{item:!0,xs:6,sm:4,children:s.jsxs(G,{sx:{display:"flex",gap:1},children:[s.jsxs(ft,{value:this.state.timeUnit,onChange:h=>this.setState({timeUnit:h.target.value}),size:"small",sx:{width:120},children:[s.jsx(L,{value:"minutes",children:"Minutes"}),s.jsx(L,{value:"hours",children:"Hours"})]}),s.jsx(F,{label:"Wish Time",type:"number",fullWidth:!0,value:this.state.timeUnit==="hours"?Math.round(this.props.wishstats.wishcap/60*100)/100:this.props.wishstats.wishcap,onChange:h=>{const r=Number(h.target.value),c=this.state.timeUnit==="hours"?r*60:r;this.handleChange({target:{value:c}},"wishcap")},onFocus:this.handleFocus,inputProps:{step:"any"}})]})}),s.jsx(P,{item:!0,xs:12,sm:4,children:s.jsx(Q,{control:s.jsx(V,{checked:this.props.wishstats.equalResources,onChange:h=>this.props.handleSettings("wishstats",{...this.props.wishstats,equalResources:!this.props.wishstats.equalResources})}),label:"Equal resources"})}),s.jsx(P,{item:!0,xs:12,children:s.jsx(bt,{...this.props,name:"wishstats",e:!0,m:!0,r:!0})}),s.jsx(P,{item:!0,xs:12,children:s.jsx(St,{...this.props,handleChange:this.handleChange})}),s.jsx(P,{item:!0,xs:12,children:s.jsx(wt,{header:"Wish slots",value:this.props.wishstats.wishes.length,name:"wishslots",handleClick:this.props.handleCrement,min:1,max:100})})]})}),s.jsx(G,{sx:{mb:2},children:this.props.wishstats.wishes.map((h,r)=>s.jsx(z,{sx:{p:2,mb:2},children:s.jsxs(P,{container:!0,spacing:2,alignItems:"center",children:[s.jsx(P,{item:!0,xs:12,children:[B.keys()].map(c=>s.jsx("div",{style:{display:"inline"},children:s.jsx(Pt,{...this.props,handleChange:this.handleChange,wishidx:h.wishidx,idx:r})},"wishform"+r))}),s.jsx(P,{item:!0,xs:6,children:s.jsx(F,{label:"Start level",type:"number",fullWidth:!0,value:this.props.wishstats.wishes[r].start,onChange:c=>this.handleChange(c,"start",r),onFocus:this.handleFocus,inputProps:{step:"any"}})}),s.jsx(P,{item:!0,xs:6,children:s.jsx(F,{label:"Target level",type:"number",fullWidth:!0,value:this.props.wishstats.wishes[r].goal,onChange:c=>this.handleChange(c,"goal",r),onFocus:this.handleFocus,inputProps:{step:"any"}})})]})},r))}),s.jsx(z,{sx:{mb:2,overflowX:"auto"},children:s.jsx(Y,{size:"small",children:s.jsx(J,{children:p.map((h,r)=>s.jsxs(H,{children:[s.jsxs(T,{children:["Wish ",this.props.wishstats.wishes[r].wishidx," requires:"]}),h.map((c,u)=>s.jsx(T,{children:s.jsx(F,{hiddenLabel:!0,size:"small",value:K(c),InputProps:{readOnly:!0,endAdornment:s.jsx(et,{position:"end",children:["E","M","R"][u]})},onClick:this.copyToClipboard,sx:{width:"12ch"}})},u)),s.jsx(T,{children:U(n[r])})]},r))})})}),s.jsxs($,{variant:"body1",align:"center",gutterBottom:!0,children:["After ",i," all targets will be reached."]}),s.jsx(z,{sx:{p:2,mb:2},children:s.jsxs(P,{container:!0,spacing:2,alignItems:"center",justifyContent:"center",children:[s.jsx(P,{item:!0,children:s.jsx($,{children:"Spare resources:"})}),w.map((h,r)=>s.jsx(P,{item:!0,children:s.jsx(F,{hiddenLabel:!0,size:"small",value:K(h),InputProps:{readOnly:!0,endAdornment:s.jsx(et,{position:"end",children:["E","M","R"][r]})},onClick:this.copyToClipboard,sx:{width:"12ch"}})},r))]})}),s.jsxs(z,{sx:{p:2},children:[s.jsx(Q,{control:s.jsx(V,{checked:this.props.wishstats.trueTime,onChange:h=>this.props.handleSettings("wishstats",{...this.props.wishstats,trueTime:!this.props.wishstats.trueTime})}),label:"Wish time estimation"}),this.props.wishstats.trueTime&&s.jsxs(Y,{size:"small",children:[s.jsx(jt,{children:s.jsxs(H,{children:[s.jsx(T,{children:"Wish"}),s.jsx(T,{children:"in theory"}),s.jsx(T,{children:"in practice"}),s.jsx(T,{children:"stops at"})]})}),s.jsx(J,{children:this.props.wishstats.wishes.map((h,r)=>s.jsxs(H,{children:[s.jsx(T,{children:h.wishidx+" ("+h.start+" → "+h.goal+")"}),s.jsx(T,{children:U(n[r])}),s.jsx(T,{children:U(b[r][1])}),s.jsx(T,{children:"level "+b[r][2]})]},r))})]})]})]})})}}export{Nt as default};
