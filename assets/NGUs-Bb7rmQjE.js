import{Q as N,a4 as C,e as T,j as e,$ as G,a0 as H,I as _,L as k,U as S}from"./index-BnwOAjjQ.js";import{n as F,G as b,T as B,k as M,l as d,j as R,d as f}from"./util-DK8B1WaS.js";import{M as E}from"./ModifierForm-CXEREbD7.js";import{T as x,S as W}from"./TextField-p200wOhE.js";import{F as U,C as w}from"./SaveForm-CkFnAjRB.js";import{T as q}from"./TableHead-D857zDYR.js";import{T as j}from"./TableSortLabel-DDKqBEob.js";import"./Stack-DduAglPJ.js";class z{constructor(s){this.ngustats=s.ngustats,this.state=s}speed(s){let t=this.ngustats[s].nguspeed;return s==="energy"?t*=F(this.ngustats,this.state,N.ENGU,{eBetaPot:2,eDeltaPot:2}):s==="magic"&&(t*=F(this.ngustats,this.state,N.MNGU,{mBetaPot:2,mDeltaPot:2})),t}bonus(s,t){return this.nbonus(s,Number(t.normal))*this.ebonus(s,Number(t.evil))*this.sbonus(s,Number(t.sadistic))}nbonus(s,t){return this.vbonus("normal",s,t)}ebonus(s,t){return this.vbonus("evil",s,t)}sbonus(s,t){return this.vbonus("sadistic",s,t)}vbonus(s,t,r){if(t.name==="Respawn")return this.respawnbonus(s,t,r);if(r<=0)return 1;if(r>1e9)return 1e9;if(isNaN(r))return 1;const o=t[s];return r<=o.softcap?1+r*o.bonus:1+r**o.scexponent*o.scbonus*o.bonus}respawnbonus(s,t,r){if(r<=0)return 1;if(r>1e9)return 1e9;if(isNaN(r))return 1;const o=t[s];if(r<=o.softcap){const i=1-r*o.bonus,h={normal:.8,evil:.925,sadistic:.925}[s];return Math.max(i,h)}const a=1-r/(r*o.scbonus+2e5)-o.scexponent,n={normal:.6,evil:.9,sadistic:.9}[s];return Math.max(a,n)}reachableBonus(s,t,r,o,a){const n=this.reachable(s,t,r,o),i=o?"magic":"energy";return{level:n,bonus:{normal:this.bonus(C[i][r],{...s,normal:n.normal}),evil:this.bonus(C[i][r],{...s,normal:a.e2n?Math.min(1e9,Number(s.normal)+n.evil-Number(s.evil)):s.normal,evil:n.evil}),sadistic:this.bonus(C[i][r],{...s,normal:a.s2e&&a.e2n?Math.min(1e9,Number(s.normal)+n.sadistic-Number(s.sadistic)):s.normal,evil:a.s2e?Math.min(1e9,Number(s.evil)+n.sadistic-Number(s.sadistic)):s.evil,sadistic:n.sadistic})}}}reachable(s,t,r,o){const a=o?"magic":"energy";return{normal:this.vreachable(Number(s.normal),t,1,C[a][r].normal.cost,a),evil:this.vreachable(Number(s.evil),t,1,C[a][r].evil.cost,a),sadistic:this.vreachable(Number(s.sadistic),t,1e7,C[a][r].sadistic.cost,a)}}bbtill(s,t,r,o,a){return o*a/r/s}vreachable(s,t,r,o,a){const n=this.ngustats[a].cap,i=this.speed(a);let h=t*60*50;const l=n*i/r/o;if(500*l>s)for(let g=1;g<501;g++){if(g*l>=s+Math.floor(h/g))return Math.min(1e9,s+Math.floor(h/g));Math.floor(g*l)>s&&(h-=g*(Math.floor(g*l)-s),s=Math.floor(g*l))}for(;h>0&&s<1e9;)h-=Math.ceil(o*(s+1)*r/(n*i)),s++;return h<0&&s--,Math.min(1e9,s)}}class K extends T.Component{constructor(s){super(s),this.state={sortConfig:{key:"reachable_level",direction:"descending"},timeUnit:"minutes",isReady:!1},this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.requestSort=this.requestSort.bind(this)}componentDidMount(){setTimeout(()=>this.setState({isReady:!0}),300)}requestSort(s){let t="descending";this.state.sortConfig.key===s&&this.state.sortConfig.direction==="descending"&&(t="ascending"),this.setState({sortConfig:{key:s,direction:t}})}handleFocus(s){s.target.select()}handleSubmit(s){s.preventDefault()}handleChange(s,t,r=-1,o=-1){let a=s.target.value,n={...this.props.ngustats};if(r<0&&o<0){if(t==="e2n"||t==="s2e"){n={...n,quirk:{...n.quirk,[t]:!this.props.ngustats.quirk[t]}},this.props.handleSettings("ngustats",n);return}n={...n,[t]:a},n.ngutime>365*1440&&(n.ngutime=365*1440),this.props.handleSettings("ngustats",n);return}const i=o===1?"magic":"energy";if(r<0){n={...n,[i]:{...n[i],[t]:a}},this.props.handleSettings("ngustats",n);return}let h={...n[i].ngus},l={...h[r],[t]:a};h[r]=l,n={...n,[i]:{...n[i],ngus:h}},this.props.handleSettings("ngustats",n)}sortHandler(s){return()=>this.requestSort(s)}render(){if(!this.state.isReady)return e.jsx(G,{});H.pageview("/ngus/");let s=new z(this.props);const t=this.props.ngustats.energy,r=this.props.ngustats.magic,o=this.props.ngustats.ngutime,{key:a,direction:n}=this.state.sortConfig;return e.jsx(_,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:2},children:e.jsxs("form",{onSubmit:this.handleSubmit,children:[e.jsx(b,{container:!0,spacing:2,justifyContent:"center",sx:{mb:2},children:e.jsxs(b,{item:!0,xs:12,md:8,children:[e.jsx(k,{sx:{p:2},elevation:3,children:e.jsxs(b,{container:!0,spacing:2,children:[e.jsx(b,{item:!0,xs:6,sm:3,children:e.jsx(x,{label:"Energy cap",value:t.cap,onChange:i=>this.handleChange(i,"cap",-1,0),onFocus:this.handleFocus,type:"number",fullWidth:!0,inputProps:{step:"any"}})}),e.jsx(b,{item:!0,xs:6,sm:3,children:e.jsx(x,{label:"Energy NGU speed",value:t.nguspeed,onChange:i=>this.handleChange(i,"nguspeed",-1,0),onFocus:this.handleFocus,type:"number",fullWidth:!0,inputProps:{step:"any"}})}),e.jsx(b,{item:!0,xs:6,sm:3,children:e.jsx(x,{label:"Magic cap",value:r.cap,onChange:i=>this.handleChange(i,"cap",-1,1),onFocus:this.handleFocus,type:"number",fullWidth:!0,inputProps:{step:"any"}})}),e.jsx(b,{item:!0,xs:6,sm:3,children:e.jsx(x,{label:"Magic NGU speed",value:r.nguspeed,onChange:i=>this.handleChange(i,"nguspeed",-1,1),onFocus:this.handleFocus,type:"number",fullWidth:!0,inputProps:{step:"any"}})}),e.jsx(b,{item:!0,xs:12,sm:4,children:e.jsxs(_,{sx:{display:"flex",gap:1},children:[e.jsxs(W,{value:this.state.timeUnit,onChange:i=>this.setState({timeUnit:i.target.value}),size:"small",sx:{width:120},children:[e.jsx(S,{value:"minutes",children:"Minutes"}),e.jsx(S,{value:"hours",children:"Hours"})]}),e.jsx(x,{label:"NGU Time",value:this.state.timeUnit==="hours"?Math.round(o/60*100)/100:o,onChange:i=>{const h=Number(i.target.value),l=this.state.timeUnit==="hours"?h*60:h;this.handleChange({target:{value:l}},"ngutime")},onFocus:this.handleFocus,type:"number",fullWidth:!0,inputProps:{step:"any"}})]})}),e.jsx(b,{item:!0,xs:6,sm:4,children:e.jsx(U,{control:e.jsx(w,{checked:this.props.ngustats.quirk.e2n,onChange:i=>this.handleChange(i,"e2n")}),label:"Evil -> Normal Quirk"})}),e.jsx(b,{item:!0,xs:6,sm:4,children:e.jsx(U,{control:e.jsx(w,{checked:this.props.ngustats.quirk.s2e,onChange:i=>this.handleChange(i,"s2e")}),label:"Sadistic -> Evil Quirk"})})]})}),e.jsx(E,{...this.props,name:"ngustats",e:!0,m:!0,r:!1})]})}),e.jsx(k,{sx:{width:"100%",overflowX:"auto"},elevation:3,children:e.jsxs(B,{size:"small",children:[e.jsx(q,{children:e.jsxs(M,{children:[e.jsx(d,{children:e.jsx(j,{active:a==="name",direction:a==="name"?n==="ascending"?"asc":"desc":"asc",onClick:this.sortHandler("name"),children:"Name"})}),e.jsx(d,{children:e.jsx(j,{active:a==="normal",direction:a==="normal"?n==="ascending"?"asc":"desc":"asc",onClick:this.sortHandler("normal"),children:"Normal Level"})}),e.jsx(d,{children:e.jsx(j,{active:a==="evil",direction:a==="evil"?n==="ascending"?"asc":"desc":"asc",onClick:this.sortHandler("evil"),children:"Evil Level"})}),e.jsx(d,{children:e.jsx(j,{active:a==="sadistic",direction:a==="sadistic"?n==="ascending"?"asc":"desc":"asc",onClick:this.sortHandler("sadistic"),children:"Sadistic Level"})}),e.jsx(d,{children:e.jsx(j,{active:a==="bonus",direction:a==="bonus"?n==="ascending"?"asc":"desc":"asc",onClick:this.sortHandler("bonus"),children:"Current Bonus"})}),e.jsx(d,{children:e.jsxs(j,{active:a==="reachable_normal_change",direction:a==="reachable_normal_change"?n==="ascending"?"asc":"desc":"asc",onClick:this.sortHandler("reachable_normal_change"),children:["Reachable Normal Level",e.jsx("br",{}),"(Bonus Change)"]})}),e.jsx(d,{children:e.jsxs(j,{active:a==="reachable_evil_change",direction:a==="reachable_evil_change"?n==="ascending"?"asc":"desc":"asc",onClick:this.sortHandler("reachable_evil_change"),children:["Reachable Evil Level",e.jsx("br",{}),"(Bonus Change)"]})}),e.jsx(d,{children:e.jsxs(j,{active:a==="reachable_sadistic_change",direction:a==="reachable_sadistic_change"?n==="ascending"?"asc":"desc":"asc",onClick:this.sortHandler("reachable_sadistic_change"),children:["Reachable Sadistic Level",e.jsx("br",{}),"(Bonus Change)"]})})]})}),e.jsx(R,{children:["energy","magic"].map(i=>{const h=i==="magic"?1:0;let l=this.props.ngustats[i].ngus,g=C[i].map((p,u)=>{const v=s.bonus(p,l[u]),c=s.reachableBonus(l[u],o,u,h,this.props.ngustats.quirk);return{pos:u,ngu:p,name:p.name,normal:l[u].normal,evil:l[u].evil,sadistic:l[u].sadistic,bonus:v,reachable:c,reachable_level:c.level.normal,reachable_evil:c.level.evil,reachable_sadistic:c.level.sadistic,reachable_normal_change:c.bonus.normal/v,reachable_evil_change:c.bonus.evil/v,reachable_sadistic_change:c.bonus.sadistic/v}});this.state.sortConfig.key&&g.sort((p,u)=>p[this.state.sortConfig.key]<u[this.state.sortConfig.key]?this.state.sortConfig.direction==="ascending"?-1:1:p[this.state.sortConfig.key]>u[this.state.sortConfig.key]?this.state.sortConfig.direction==="ascending"?1:-1:0);const P=g.map(p=>{const{pos:u,ngu:v,bonus:c,reachable:m}=p;return e.jsxs(M,{children:[e.jsx(d,{component:"th",scope:"row",children:v.name}),e.jsx(d,{children:e.jsx(x,{type:"number",value:l[u].normal,onFocus:this.handleFocus,onChange:y=>this.handleChange(y,"normal",u,h),inputProps:{step:"any"},sx:{width:140},hiddenLabel:!0,size:"small"})}),e.jsx(d,{children:e.jsx(x,{type:"number",value:l[u].evil,onFocus:this.handleFocus,onChange:y=>this.handleChange(y,"evil",u,h),inputProps:{step:"any"},sx:{width:140},hiddenLabel:!0,size:"small"})}),e.jsx(d,{children:e.jsx(x,{type:"number",value:l[u].sadistic,onFocus:this.handleFocus,onChange:y=>this.handleChange(y,"sadistic",u,h),inputProps:{step:"any"},sx:{width:140},hiddenLabel:!0,size:"small"})}),e.jsx(d,{children:"×"+f(c*100)+"%"}),e.jsxs(d,{children:[f(m.level.normal)," (×",f(m.bonus.normal/c,4),") ",Math.round((m.bonus.normal/c-1)*100)!==0&&e.jsxs("span",{style:{color:"green",fontWeight:"bold"},children:["(",Math.abs((m.bonus.normal/c-1)*100%1)>.01?"~":"",Math.round((m.bonus.normal/c-1)*100),"%)"]})]}),e.jsxs(d,{children:[f(m.level.evil)," (×",f(m.bonus.evil/c,4),") ",Math.round((m.bonus.evil/c-1)*100)!==0&&e.jsxs("span",{style:{color:"green",fontWeight:"bold"},children:["(",Math.abs((m.bonus.evil/c-1)*100%1)>.01?"~":"",Math.round((m.bonus.evil/c-1)*100),"%)"]})]}),e.jsxs(d,{children:[f(m.level.sadistic)," (×",f(m.bonus.sadistic/c,4),") ",Math.round((m.bonus.sadistic/c-1)*100)!==0&&e.jsxs("span",{style:{color:"green",fontWeight:"bold"},children:["(",Math.abs((m.bonus.sadistic/c-1)*100%1)>.01?"~":"",Math.round((m.bonus.sadistic/c-1)*100),"%)"]})]})]},i+u)});return[e.jsx(M,{sx:{backgroundColor:"action.hover"},children:e.jsx(d,{colSpan:8,sx:{backgroundColor:"action.hover",typography:"subtitle1",fontWeight:700},children:i.charAt(0).toUpperCase()+i.slice(1)+" NGUs"})},i+"_header"),...P]})})]})})]})})}}export{K as default};
